const mysql=require('mysql');

class ClassCrud{

    constructor()
    {
        this.sql=mysql.createPool({
            user: "root",
            password: "password",
            host: "localhost",
            database: "atividadeCRUD"
        });
    }

    read(req,res)
    {
        if(!req.params.id){
            this.sql.getConnection(function(err,connection){
                connection.query("select * from product order by id asc",function(err,results,fields){
                    res.render('select',{data:results});
                });
            });
        }else{
            this.sql.getConnection(function(err,connection){
                sql.query("select * from product where id=? order by id asc",[req.params.id],function(err,results,fields){
                    res.render('select',{data:results});
                });
            });
        }
    }

    create(req,res)
    {
        this.sql.getConnection(function(err,connection){
            connection.query("insert into product values (?,?,?)",[req.body.id,req.body.name,req.body.price]);
            res.render('controllerForm',{name:req.body.name});
        });
    }

    deletes(req,res)
    {
        this.sql.getConnection(function(err,connection){
            connection.query("delete from product where id=?",[req.params.id]);
            res.render('deletar');
        });
    }

    update(req,res,controller=null)
    {
        if(controller==null){
            this.sql.getConnection(function(err,connection){
                connection.query("select * from product where id=?",[req.params.id],function(err,results,fields){
                    res.render('update',{id:req.params.id,name:results[0].name,price:results[0].price});
                });
            });
        }else{
            this.sql.getConnection(function(err,connection){
                connection.query("update product set name=?,price=? where id=?",[req.body.name,req.body.price,req.body.id]);
                res.render('controllerUpdate');
            });
        }
    }
}
module.exports=ClassCrud;